# DDD勉強会 実践課題その1

## 準備
### サンプルアプリ起動
```shell
./tools/scripts/run-webapp-todo-example
```

### サンプルアプリURL
http://localhost:38080

---

## セキュリティ面での効果
DDDを意識するとセキュリティ面でも強固になっていく事を知る
### XSS(クロスサイトスクリプティング)
XSSを試してみる
- TODO新規登録画面を開く
- タイトルに `"><script>alert(999)</script>`を入力して登録する
  - 何が起きた？
  - どうやったら防げるか改善案を出してみる
  - 改善案を実装してみる
    - ここではまだ新しいクラスは作らないものとする

### SQLインジェクション
SQLインジェクションを試してみる
- TODO詳細画面を開く
- TODO詳細画面のURLパラメータの末尾に `';delete%20from%20todo.todos;--` をつけてアクセスしてみる 
  - 何が起きた？
  - どうやったら防げるか改善案を出してみる

---

## モデリング(1)

### ロジックをモデルに集約する
- コントローラに存在しているロジックを何とかする
  - 改善案を考えてみる
  - 改善案を実装してみる

### バリデーションの実装
最低限のバリデーションを実装する
- 新規登録画面に記載されているルールをドメインモデルに実装する
- この時点ではまだ新しいクラスは作らずにやってみる
  - isValidメソッドに実装する
- Beanバリデーションはまだ使わない
- エラー理由に関わらず画面表示するバリデーションエラーメッセージは1種類のみでOK

### バリューオブジェクト
Todoクラスのフィールドをバリューオブジェクトに置き換えるリファクタリング
- まずは`タイトル`だけやってみる
  - イミュータブルなオブジェクトにする

---

## モデルの変更影響を小さくする
ドメインモデルをDBや画面で直接扱うと、モデルの変更が影響範囲が大きくなってしまう問題に対処する効果的なデザインパターンを知る

### DTO(Data Transfer Object)
モデルを画面やDBアクセスに直接使わずに、間にDTOと呼ばれる受け渡し用のクラスを挟むデザインパターン

- Form
  - 画面とモデルの間に差し込むDTOを使ってみる
    - presentation.controller.todo.form.TodoForm
    - まだBeanバリデーションは実装しない

- Dao
  - 永続化層(主にDB)とモデルの間に差し込むDTOを使ってみる
    - infrastructure.datasource.dao.TodoDao
    - infrastructure.datasource.dao.TodoListDao

### SQLマッパー
SQLとJavaオブジェクトのマッピングをライブラリを使って`宣言的`に行う
- Datasource実装をMyBatisを使ったデータアクセスに切り替えてみる

---

## Beanバリデーション
FormクラスにBeanバリデーションを実装する
- ドメインモデルで決めたルールをBeanバリデーションで表現する

---

## モデリング(2)
TODOの「参照」「新規登録」を業務としてモデリングする
- TODO登録業務をモデリングして実装してみる


---

## その他リファクタリングネタ

- Controllerを適切に分割する
- 緊急フラグの画面表現を改善する
- すべてのモデルををイミュータブルにする
- TODO詳細をIDから取得するように変更する
- TODOを編集可能にする
- TODOを削除可能にする
- DONEを実装する
- Controllerで@ModelAttribute を使う